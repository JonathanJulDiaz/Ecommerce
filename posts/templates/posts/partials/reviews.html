<div class="bg-gray-300 rounded-lg flex mb-2 w-1/2">
    <div class="text-center w-1/4 m-2">
      <h2>Calificaciones y Reseñas</h2>
      <span class="display-4 font-weight-bolder">{{ average|floatformat }}</span><br />
      <span class="text-black-50">de 5</span>
    </div>

    <div class="w-3/4 m-2">
      <div class="flex items-center">
        <p class="text-sm text-nowrap mr-1">1</p>
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512">
          <path fill="#f6ff00" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
        </svg>
        <div class="progress w-full m-2">
          <div class="progress-bar bg-warning" role="progressbar" style="width: {{ porcentaje.0 }}%;" aria-valuenow="{{ typeEstrellas.0 }}" aria-valuemin="0" aria-valuemax="{{ reviews.count }}">
            <b class="mx-1 text-black font-sans">{{ porcentaje.0|floatformat }} %</b>
          </div>
        </div>
      </div>
      <div class="flex items-center">
        <p class="text-sm text-nowrap mr-1">2</p>
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512">
          <path fill="#f6ff00" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
        </svg>
        <div class="progress m-2 w-full">
          <div class="progress-bar bg-warning" role="progressbar" style="width: {{ porcentaje.1 }}%;" aria-valuenow="{{ typeEstrellas.1 }}" aria-valuemin="0" aria-valuemax="{{ reviews.count }}">
            <b class="mx-1 text-black font-sans">{{ porcentaje.1|floatformat }} %</b>
          </div>
        </div>
      </div>
      <div class="flex items-center">
        <p class="text-sm text-nowrap mr-1">3</p>
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512">
          <path fill="#f6ff00" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
        </svg>
        <div class="progress m-2 w-full">
          <div class="progress-bar bg-warning" role="progressbar" style="width: {{ porcentaje.2 }}%;" aria-valuenow="{{ typeEstrellas.2 }}" aria-valuemin="0" aria-valuemax="{{ reviews.count }}">
            <b class="mx-1 text-black font-sans">{{ porcentaje.2|floatformat }} %</b>
          </div>
        </div>
      </div>
      <div class="flex items-center">
        <p class="text-sm text-nowrap mr-1">4</p>
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512">
          <path fill="#f6ff00" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
        </svg>
        <div class="progress m-2 w-full">
          <div class="progress-bar bg-warning" role="progressbar" style="width: {{ porcentaje.3 }}%;" aria-valuenow="{{ typeEstrellas.3 }}" aria-valuemin="0" aria-valuemax="{{ reviews.count }}">
            <b class="mx-1 text-black font-sans">{{ porcentaje.3|floatformat }} %</b>
          </div>
        </div>
      </div>
      <div class="flex items-center">
        <p class="text-sm text-nowrap mr-1">5</p>
        <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512">
          <path fill="#f6ff00" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
        </svg>
        <div class="progress m-2 w-full">
          <div class="progress-bar bg-warning" role="progressbar" style="width: {{ porcentaje.4 }}%;" aria-valuenow="{{ typeEstrellas.4 }}" aria-valuemin="0" aria-valuemax="{{ reviews.count }}">
            <b class="mx-1 text-black font-sans">{{ porcentaje.4|floatformat }} %</b>
          </div>
        </div>
      </div>
    </div>
  </div>

  <h2 class="text-black text-2xl mb-2">Reseñas ({{ reviews.count }})</h2>

  {% if request.user.is_authenticated %}

    {% include 'posts/partials/review_form.html' with request=request product=product only %}

  {% else %}

    <h2 class="text-md text-gray-600 mb-3">Si deseas comentar, debes <b><a class="hover:text-gray-800" href="{% url 'log-in' %}">iniciar sesión</a></b></h2>
  
  {% endif %}

  <div class="">
    {% for r in reviews %}
      <article class="p-6 text-base rounded-lg bg-gray-800 mb-2">
        <footer class="flex justify-between items-center mb-2">
          <div class="flex items-center">
            <p class="inline-flex items-center mr-3 text-sm text-gray-900 dark:text-white font-semibold">
              {% if r.user.userprofile.imagen %}
                <img src="{{ r.user.userprofile.imagen.url }}" alt="Imagen de {{ r.user.username }}" class="mr-2 w-6 h-6 rounded-full object-cover" />
              {% else %}
                <img src="/media/uploads/userprofile/No%20Photo.jpg" alt="Imagen de {{ r.user.username }}" class="mr-2 w-6 h-6 rounded-full" />
              {% endif %}

              <a href="{% url 'profile' r.user.id %}">
                {{ r.user.username }}
              {% if r.user.get_full_name %}
                ({{ r.user.get_full_name }})
              {% endif %}
              </a>
              
              {% if r.user == product.user %}
                <span class="badge rounded-pill bg-primary ml-1">Vendedor</span>
              {% endif %}
            </p>
            <p class="text-sm text-gray-600">Publicado hace {{ r.created_at|timesince }}</p>
          </div>
          <!-- Botón de opción de comentario -->
          <button id="dropdownComment1Button" data-dropdown-toggle="dropdownComment1" class="inline-flex items-center p-2 text-sm font-medium text-center text-gray-500 bg-gray-400 rounded-lg hover:text-gray-600 hover:bg-gray-300" type="button">
            <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 3">
              <path d="M2 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm6.041 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM14 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z" />
            </svg>
            <span class="sr-only">Opciones de comentario</span>
          </button>
          <!-- Dropdown menu -->
          <div id="dropdownComment1" class="hidden z-10 w-36 bg-white rounded divide-y divide-gray-100 shadow dark:bg-gray-700 dark:divide-gray-600">
            <ul class="py-1 text-sm text-gray-700 dark:text-gray-200" aria-labelledby="dropdownMenuIconHorizontalButton">
              <li>
                <a href="#" class="block py-2 px-4 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Edit</a>
              </li>
              <li>
                <a href="#" class="block py-2 px-4 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Remove</a>
              </li>
              <li>
                <a href="#" class="block py-2 px-4 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white">Report</a>
              </li>
            </ul>
          </div>
        </footer>

        <div class="select-none mb-1">
          <div class="flex items-center">
            {% for i in r.get_estrellas %}
              <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 576 512">
                <path fill="#f6ff00" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z" />
              </svg>
            {% endfor %}
          </div>
        </div>

        <p class="text-gray-500 dark:text-gray-400">{{ r.descripcion }}</p>
        <div class="flex items-center mt-4 space-x-4">
          <div class="flex items-center select-none">
            <p class="text-gray-400 text-sm">{{ r.like }}</p>

            <svg class="ml-1 mr-2" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
              <path fill="#808080" d="M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 504 288.9 504 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H294.5c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3V320 272 247.1c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192H96c17.7 0 32 14.3 32 32V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V224c0-17.7 14.3-32 32-32z" />
            </svg>

            <p class="text-gray-400 text-sm">{{ r.dislike }}</p>

            <svg class="ml-1" xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512">
              <path fill="#808080" d="M313.4 479.1c26-5.2 42.9-30.5 37.7-56.5l-2.3-11.4c-5.3-26.7-15.1-52.1-28.8-75.2H464c26.5 0 48-21.5 48-48c0-18.5-10.5-34.6-25.9-42.6C497 236.6 504 223.1 504 208c0-23.4-16.8-42.9-38.9-47.1c4.4-7.3 6.9-15.8 6.9-24.9c0-21.3-13.9-39.4-33.1-45.6c.7-3.3 1.1-6.8 1.1-10.4c0-26.5-21.5-48-48-48H294.5c-19 0-37.5 5.6-53.3 16.1L202.7 73.8C176 91.6 160 121.6 160 153.7V192v48 24.9c0 29.2 13.3 56.7 36 75l7.4 5.9c26.5 21.2 44.6 51 51.2 84.2l2.3 11.4c5.2 26 30.5 42.9 56.5 37.7zM32 384H96c17.7 0 32-14.3 32-32V128c0-17.7-14.3-32-32-32H32C14.3 96 0 110.3 0 128V352c0 17.7 14.3 32 32 32z" />
            </svg>
          </div>

          <button type="button" class="flex items-center text-sm text-gray-500 hover:underline dark:text-gray-400 font-medium">
            <svg class="mr-1.5 w-3.5 h-3.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 18">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5h5M5 8h2m6-3h2m-5 3h6m2-7H2a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1h3v5l5-5h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z" />
            </svg>
            Responder
          </button>
        </div>
      </article>
    {% endfor %}
  </div>